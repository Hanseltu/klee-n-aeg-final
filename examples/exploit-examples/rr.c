#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "klee/klee.h"
struct Type1 {char data [8];};
struct Type2 {
    int status;
    unsigned long * ptr;
};
int (*handler)(const int*);
int goodFunc(const int* var){printf("/////This is a Good function\n");return 0;}
int badFunc(const int* var){printf("/////This is a Evil function\n");return 0;}

int global_a;
int (*global_p)(const int*);

struct {struct Type1* obj1; struct Type2* obj2;} gvar = {};
int main(int argc, char* argv[]){
    gvar.obj1 = (struct Type1*)malloc(sizeof(struct Type1));
    gvar.obj2 = (struct Type2*)malloc(sizeof(struct Type2));

    printf ("size of obj1:%lx, size of obj2: %lx. \n", sizeof(gvar.obj1), sizeof(gvar.obj2));
    printf ("addr of gvar.obj1: %p, addr of obj2: %p. \n", gvar.obj1, gvar.obj2);
    printf ("addr of gvar.obj1->data: %p, addr of obj2->status: %p. %p. \n", &gvar.obj1->data, &gvar.obj2->status, &gvar.obj2->ptr);
    printf ("addr of handler: %p. \n", &handler);

    handler = goodFunc; //Here we should call a Good function
    //global_p = &badFunc;


    global_p(gvar.obj2->ptr);
        //local_p(gvar.obj2->ptr);

    return 0;
}

